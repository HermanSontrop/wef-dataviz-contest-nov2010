<html>
  <head>
    <title>World Economic Forum - Visualization Challenge - Jan Willem Tulp</title>
	<style type="text/css">
		body { margin: 0 auto; text-align: center;}
	</style>
	<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="protovis-r3.2.js"></script>
    <script type="text/javascript" src="GA11.js"></script>
    <script type="text/javascript" src="GA12.js"></script>
	<script type="text/javascript" src="GA13.js"></script>
	<script type="text/javascript" src="GA14.js"></script>
	<script type="text/javascript" src="GA15.js"></script>
	<script type="text/javascript" src="RA11.js"></script>
	<script type="text/javascript" src="RA12.js"></script>
	<script type="text/javascript" src="RA13.js"></script>
	<script type="text/javascript" src="IA11.js"></script>		
	<script type="text/javascript" src="IA12.js"></script>
	<script type="text/javascript" src="IA13.js"></script>
	<script type="text/javascript" src="util.js"></script>
    <style type="text/css">

body {
  margin: 0;
}

    </style>
  </head>
  <body>
    <script type="text/javascript+protovis">

	var GA = [{r: 1, a: "GA"}, {r: 2, a: "GA"}, {r: 3, a: "GA"}, {r: 4, a: "GA"}, {r: 5, a: "GA"}]
	var RA = [{r: 1, a: "RA"}, {r: 2, a: "RA"}, {r: 3, a: "RA"}]
	var IA = [{r: 1, a: "IA"}, {r: 2, a: "IA"}, {r: 3, a: "IA"}]

	var selectedRC = ""
	var selectedLC = ""
	var selectedAgenda = "RA"
	var selectedRank = 1

	var w = document.body.clientWidth,
    	//h = document.body.clientHeight,
		h = 1000, 
		r = h / 3.75,
		linkData = eval("links" + selectedAgenda + "1" + selectedRank),
		linkedCouncils = eval("linkedCouncils" + selectedAgenda + "1" + selectedRank),
		respondentCouncils = eval("respondentCouncils" + selectedAgenda + "1" + selectedRank),
		c = pv.Scale.linear(0, 1).range('#A9AFA1', '#1C232E'),
		rcw = pv.Scale.linear(pv.normalize(respondentCouncils.map(function(d) d.lcs.length))).range("#1A1F2B", "#2794E0"),
		lcw = pv.Scale.linear(pv.normalize(linkedCouncils.map(function(d) d.rcs.length))).range("#1C232E", "#FF6A00"),
		offsetX = 35,
		offsetY = 70;

	function updateData() {
		linkData = eval("links" + selectedAgenda + "1" + selectedRank)
		linkedCouncils = eval("linkedCouncils" + selectedAgenda + "1" + selectedRank)
		respondentCouncils = eval("respondentCouncils" + selectedAgenda + "1" + selectedRank)
		rcw = pv.Scale.linear(pv.normalize(respondentCouncils.map(function(d) d.lcs.length))).range("#1A1F2B", "#2794E0")
		lcw = pv.Scale.linear(pv.normalize(linkedCouncils.map(function(d) d.rcs.length))).range("#1C232E", "#FF6A00")
	}

	function getLineData(index, target, size) {
		return[
			{ 
				x: (w / 2 - offsetX + r * Math.sin(Math.PI * -2 * .5 * index / linkData.length)),
				y: (h / 2 - offsetY + r * Math.cos(Math.PI * 2 * .5 * index / linkData.length))
			}, 
			{ x: w / 2, y: h / 2 - offsetY },
			{
				x: (w / 2 + offsetX + r * -1 * Math.sin(Math.PI * -2 * .5 * target / linkData.length)),
				y: (h / 2 -offsetY + r * Math.cos(Math.PI * 2 * .5 * target / linkData.length))
			}
		]
	}
	
	function generateLineData() {
		var lines = new Array()
		for (i = 0; i < linkData.length; i++) {
			lines[i] = getLineData(linkData[i].rci, linkData[i].lci, linkData[i].size)
		}
		return lines
	}

	var vis = new pv.Panel()
    	.width(w)
    	.height(h)
	
	// links between respondent Councils and linked Councils
	vis.add(pv.Panel)
		.data(function() generateLineData())
	  .add(pv.Line)
		.data(function(array) array)
		.bottom(function(d) d.y)
		.left(function(d) d.x)
		.lineWidth(function(d) linkData[this.parent.index].size)
		.strokeStyle(function() { 
			if (linkData[this.parent.index].rc == selectedRC 
				|| linkData[this.parent.index].lc == selectedLC) {
				return c(linkData[this.parent.index].strength).alpha(1)
			} else if (selectedRC == "" && selectedLC == "") {
				return c(linkData[this.parent.index].strength).alpha(.8)
			} else {
				return c(linkData[this.parent.index].strength).alpha(0)
			}})
		.interpolate("basis")
		
	// respondent Council wedge
	var rcWedge = vis.add(pv.Wedge)
		.data(function() pv.normalize(respondentCouncils.map(function(d) d.lcs.length)))
		.bottom(h / 2 - offsetY)
		.left (w / 2 - offsetX)
		.innerRadius(r)
		.outerRadius(function(d) r + respondentCouncils[this.index].linkCount * .7)
		.lineWidth(1.5)
		.strokeStyle("white")
		.fillStyle(function(d) rcw(d))
		.angle(function(d) d * -Math.PI)
		.event("mouseover", function(d) {selectedRC = respondentCouncils[this.index].rc; vis.render()})	
		.event("mouseout", function(d) {selectedRC = ""; vis.render()})
	  .anchor("outer")
	  .add(pv.Label)
		.textAlign("right")
		.text(function(d) respondentCouncils[this.index].rc)
		.font("9px Helvetica")
		.visible(function(d) {
			if (selectedRC == respondentCouncils[this.index].rc 
				|| (selectedLC == "" && selectedRC == "")
				| ($.inArray(selectedLC, respondentCouncils[this.index].lcs) > -1)) {
				return true
			} else {
				return false
			}})
		
	// linked Council wedge
	var lcWedge = vis.add(pv.Wedge)
		.data(function() pv.normalize(linkedCouncils.map(function(d) d.rcs.length)))
		.bottom(h / 2 - offsetY)
		.left (w / 2 + offsetX)
		.innerRadius(r)
		.outerRadius(function(d) r + linkedCouncils[this.index].linkCount * .7)
		.lineWidth(1.5)
		.strokeStyle("white")
		.fillStyle(function(d) lcw(d))
		.angle(function(d) d * Math.PI)
		.event("mouseover", function(d) {selectedLC = linkedCouncils[this.index].lc; vis.render()})	
		.event("mouseout", function(d) {selectedLC = ""; vis.render()})
	  .anchor("outer")
	  .add(pv.Label)
		.textAlign("left")
		.text(function(d) linkedCouncils[this.index].lc)
		.font("9px Helvetica")
		.visible(function(d) {
			if (selectedLC == linkedCouncils[this.index].lc 
				|| (selectedLC == "" && selectedRC == "")
				|| ($.inArray(selectedRC, linkedCouncils[this.index].rcs) > -1)) {
				return true
			} else {
				return false
			}})
		
	vis.add(pv.Label)
		.text("Respondent Council")
		.top(100)
		.left(w/2 - 270)
		.font("20px Helvetica")
		.textAlign("right")
		.textStyle("#1F77B4")
	  .add(pv.Label)
		.text("Linked Council")
		.left(w/2 + 270)
		.textAlign("left")
		.textStyle("#FF6A00")
	  
	vis.add(pv.Label)
		.font("15px")
		.text("Global Agenda")
		.top(140)
		.left(w/2 + 270)
		.textStyle(function(d) selectedAgenda == "GA" ? "#FF6A00" : "#AAA")
	  .add(pv.Label)
		.text("Regional Agenda")
		.top(160)
		.textStyle(function(d) selectedAgenda == "RA" ? "#FF6A00" : "#AAA")
	  .add(pv.Label)
		.text("Industry Agenda")
		.top(180)
		.textStyle(function(d) selectedAgenda == "IA" ? "#FF6A00" : "#AAA")
		
	vis.add(pv.Label)
		.top(40)
		.left(w/2)
		.textAlign("center")
		.text("World Economic Forum")
		.font("30px Helvetica")
		.textStyle("#1C232E")
	  .add(pv.Label)
		.text("Council Interlinkage Visualization")
		.top(65)
		.font("17px Helvetica")
		.textStyle("#74786E")
	  
	vis.add(pv.Bar)
	  	.data(RA)
		.top(143)
		.width(19)
		.height(19)
		.fillStyle(function(d) d.a == selectedAgenda && d.r <= selectedRank ? "#FF6A00" : "#CCC")
	 	.text(function(d) d.r)
		.left(function() w/2 + 360 + (this.index * 20))
		.event("click", function(d) { selectedAgenda = d.a; selectedRank = d.r; updateData(); vis.render(); })
	  .add(pv.Bar)
	  	.data(GA)
		.top(123)
		.event("click", function(d) { selectedAgenda = d.a; selectedRank = d.r; updateData(); vis.render(); })
	  .add(pv.Bar)
	  	.data(IA)
		.top(163)
		.event("click", function(d) { selectedAgenda = d.a; selectedRank = d.r; updateData(); vis.render(); })
		
	vis.add(pv.Label)
		.data(GA)
		.text(function(d) d.r)
		.top(200)
		.left(function() w/2 + 360 + (this.index * 20))
		.textStyle(function(d) d.r <= selectedRank ? "#FF6A00" : "#AAA")

	vis.render();	

    </script>
Hier begint de rest van de pagina, en gaat dat goed met de teksten? Ja dus!
  </body>
</html>